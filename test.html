<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Points on a map</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link
      href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 25px;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <form id="movie-form">
      <label for="location-input">Search Location</label>
      <input type="text" id="location-input" />
      <input type="text" id="location-desc" />
      <input type="text" id="location-title" />
      <input id="find-location" type="submit" value="Location Search" />
    </form>
    <div id="map"></div>
    <script>
      const locArr = [];
      mapboxgl.accessToken =
        "pk.eyJ1IjoidmIyNyIsImEiOiJjazk4cjdteTgwNDNiM21xdHQ1Y3BtbWhyIn0.oyEQCIxSrbYI1VZ208kcPw"; // replace this with your access token
      var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/vb27/ck98rwfum06mc1ikcz89mqepw", // replace this with your style URL
        center: [-120, 47],
        zoom: 6.6,
      });
      // code from the next step will go here
      $("#find-location").on("click", function (event) {
        event.preventDefault();

        var location = $("#location-input").val();
        var desc = $("#location-desc").val();
        var title = $("#location-title").val();

        var queryURL =
          "https://api.mapbox.com/geocoding/v5/mapbox.places/" +
          location +
          ".json?access_token=pk.eyJ1IjoidmIyNyIsImEiOiJjazk4cjdteTgwNDNiM21xdHQ1Y3BtbWhyIn0.oyEQCIxSrbYI1VZ208kcPw";

        $.ajax({
          url: queryURL,
          method: "GET",
        }).then(function (response) {
          console.log(response.features[0].center[0]); //long
          console.log(response.features[0].center[1]); //lat
          const newLocation =
            {
              type: "Feature",
              properties: {
                description: desc,
              },
              geometry: {
                type: "Point",
                coordinates: [
                  response.features[0].center[0],
                  response.features[0].center[1],
                ],
              },
            };
          newMap(newLocation, title);
          console.log(newLocation)
        });
      });

      function newMap(info, title) {
        map.loadImage("https://i.imgur.com/MK4NUzI.png", function (
          error,
          image
        ) {
          if (error) throw error;
          map.addImage("custom-marker", image);
          map.addLayer({
            id: title,
            type: "symbol",
            source: {
              type: "geojson",
              data: {
                type: "FeatureCollection",
                features: [info],
              },
            },
            layout: {
              "icon-image": "custom-marker",
            },
          });
        });
      }
    </script>
  </body>
</html>
